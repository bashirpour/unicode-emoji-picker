!function(e){var t="",o=!1,c={},m=!!(e.chrome&&chrome.storage&&chrome.storage.local),h=!m&&!!e.localStorage;function u(){return o?(o=!1,""):t}e.ConfigStorage={prefix:function(e){t=e},noPrefix:function(){o=!0},get:function(){for(var t,o,i=Array.prototype.slice.call(arguments),n=i.pop(),a=[],s=1==i.length,e=!0,r=u(),l=0;l<i.length;l++)if("xt_"!=(o=i[l]=r+i[l]).substr(0,3)&&void 0!==c[o])a.push(c[o]);else if(h){try{t=localStorage.getItem(o)}catch(e){h=!1}try{t=null!=t&&JSON.parse(t)}catch(e){t=!1}a.push(c[o]=t)}else m?e=!1:a.push(c[o]=!1);if(e)return n(s?a[0]:a);chrome.storage.local.get(i,function(e){var t;for(a=[],l=0;l<i.length;l++)t=null!=(t=e[o=i[l]])&&JSON.parse(t),a.push(c[o]=t);n(s?a[0]:a)})},set:function(e,t){var o,i,n={},a=u();for(o in e)if(e.hasOwnProperty(o))if(i=e[o],c[o=a+o]=i,i=JSON.stringify(i),h)try{localStorage.setItem(o,i)}catch(e){h=!1}else n[o]=i;!h&&m?chrome.storage.local.set(n,t):t&&t()},remove:function(){var e,t,o,i=Array.prototype.slice.call(arguments),n=u();for("function"==typeof i[i.length-1]&&(o=i.pop()),e=0;e<i.length;e++)if(t=i[e]=n+i[e],delete c[t],h)try{localStorage.removeItem(t)}catch(e){h=!1}m?chrome.storage.local.remove(i,o):o&&o()}}}(this),function(){function e(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var o=document.createEvent("CustomEvent");return o.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),o}"function"!=typeof window.CustomEvent&&(e.prototype=window.Event.prototype,window.CustomEvent=e)}(),function(){function e(e){var t,o;null==e&&(e={}),$.emojiarea.iconSize=null!=(t=e.iconSize)?t:25,$.emojiarea.assetsPath=null!=(o=e.assetsPath)?o:"",this.generateEmojiIconSets(e),e.emojiable_selector||(e.emojiable_selector="[data-emojiable=true]"),this.options=e}this.EmojiPicker=(e.prototype.discover=function(){if(console.log("discover"),!/iPad|iPhone|iPod/.test(navigator.userAgent)||window.MSStream)return $(this.options.emojiable_selector).emojiarea($.extend({emojiPopup:this,norealTime:!0},this.options))},e.prototype.generateEmojiIconSets=function(e){var t,o,i,n,a,s,r,l,c;for(console.log("generateEmojiIconSets"),n={},r={},c=t=l=o=s=a=i=void 0,a=0;a<Config.EmojiCategories.length;){for(c=Config.EmojiCategorySpritesheetDimens[a][1],i=0;i<Config.EmojiCategories[a].length;)s=(o=Config.Emoji[Config.EmojiCategories[a][i]])[1][0],l=Math.floor(i/c),t=i%c,n[":"+s+":"]=[a,l,t,":"+s+":"],r[s]=o[0],i++;a++}return $.emojiarea.icons=n,$.emojiarea.reverseIcons=r},e)}.call(this),function(d,i,n){d.emojiarea={assetsPath:"",spriteSheetPath:"",blankGifPath:"",iconSize:25,icons:{}};var r=":joy:,:kissing_heart:,:heart:,:heart_eyes:,:blush:,:grin:,:+1:,:relaxed:,:pensive:,:smile:,:sob:,:kiss:,:unamused:,:flushed:,:stuck_out_tongue_winking_eye:,:see_no_evil:,:wink:,:smiley:,:cry:,:stuck_out_tongue_closed_eyes:,:scream:,:rage:,:smirk:,:disappointed:,:sweat_smile:,:kissing_closed_eyes:,:speak_no_evil:,:relieved:,:grinning:,:yum:,:laughing:,:ok_hand:,:neutral_face:,:confused:".split(",");d.fn.emojiarea=function(e){this.options=e;var t=this;t.emojiMenu=new a(t),e.trigger_button.on("click",function(e){t.emojiMenu.show(t)})};var a=function(e){var o=this;o.id=e.id;var t=d(n.body);d(i);this.visible=!1,this.emojiarea=e,a.menuZIndex=5e3,this.$menu=d("<div>"),this.$menu.addClass("emoji-menu"),this.$menu.attr("data-id",o.id),this.$menu.attr("data-type","menu"),this.$menu.hide(),this.$itemsTailWrap=d('<div class="emoji-items-wrap1"></div>').appendTo(this.$menu),this.$categoryTabs=d('<table class="emoji-menu-tabs"><tr><td><a class="emoji-menu-tab icon-recent" ></a></td><td><a class="emoji-menu-tab icon-smile" ></a></td><td><a class="emoji-menu-tab icon-flower"></a></td><td><a class="emoji-menu-tab icon-bell"></a></td><td><a class="emoji-menu-tab icon-car"></a></td><td><a class="emoji-menu-tab icon-grid"></a></td></tr></table>').appendTo(this.$itemsTailWrap),this.$itemsWrap=d('<div class="emoji-items-wrap mobile_scrollable_wrap"></div>').appendTo(this.$itemsTailWrap),this.$items=d('<div class="emoji-items">').appendTo(this.$itemsWrap),this.$menu.appendTo(d("#emoji_menu")),t.on("keydown",function(e){27!==e.keyCode&&9!==e.keyCode||o.hide()}),t.on("message_send",function(e){o.hide()}),t.on("mouseup",function(e){var t=(e=e.originalEvent||e).target||i;d(t).hasClass(o.emojiarea.$dontHideOnClick)||o.hide()}),this.$menu.on("mouseup","a",function(e){return e.stopPropagation(),!1}),this.$menu.on("click","a",function(e){if(d(this).hasClass("emoji-menu-tab"))return o.getTabIndex(this)!==o.currentCategory&&o.selectCategory(o.getTabIndex(this)),!1;var t=d(".label",d(this)).text();return i.setTimeout(function(){o.onItemSelected(t),(e.ctrlKey||e.metaKey)&&o.hide()},0),e.stopPropagation(),!1}),this.selectCategory(0)};a.prototype.createIcon=function(e,t){var o=e[0],i=e[1],n=e[2],a=e[3],s=d.emojiarea.spriteSheetPath?d.emojiarea.spriteSheetPath:d.emojiarea.assetsPath+"/emoji_spritesheet_!.png",r=d.emojiarea.blankGifPath?d.emojiarea.blankGifPath:d.emojiarea.assetsPath+"/blank.gif",l=t&&Config.Mobile?26:d.emojiarea.iconSize,c=-l*n,m=-l*i,h=Config.EmojiCategorySpritesheetDimens[o][1]*l,u=Config.EmojiCategorySpritesheetDimens[o][0]*l,p="display:inline-block;";return p+="width:"+l+"px;",p+="height:"+l+"px;",p+="background:url('"+s.replace("!",o)+"') "+c+"px "+m+"px no-repeat;",'<img src="'+r+'" class="img" style="'+(p+="background-size:"+h+"px "+u+"px;")+'" alt="'+this.htmlEntities(a)+'">'},a.prototype.htmlEntities=function(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},a.prototype.getTabIndex=function(e){return console.log("EmojiMenu.prototype.getTabIndex"),this.$categoryTabs.find(".emoji-menu-tab").index(e)},a.prototype.selectCategory=function(t){this.$categoryTabs.find(".emoji-menu-tab").each(function(e){e===t?this.className+="-selected":this.className=this.className.replace("-selected","")}),this.currentCategory=t,this.load(t)},a.prototype.colonToUnicode=function(e){return console.log("colonToUnicode"),e?(Config.rx_colons||Config.init_unified(),e.replace(Config.rx_colons,function(e){var t=Config.mapcolon[e];return t||""})):""},a.prototype.onItemSelected=function(e){console.log(this.colonToUnicode(e)),console.log("onItemSelected",e)},a.prototype.load=function(e){console.log("EmojiMenu.prototype.load");var i=[],n=d.emojiarea.icons,t=d.emojiarea.assetsPath,a=this;t.length&&"/"!==t.charAt(t.length-1)&&(t+="/");function s(){a.$items.html(i.join(""))}if(0<e){for(var o in n)n.hasOwnProperty(o)&&n[o][0]===e-1&&i.push('<a href="javascript:void(0)" title="'+a.htmlEntities(o)+'">'+a.createIcon(n[o],!0)+'<span class="label">'+a.htmlEntities(o)+"</span></a>");s()}else ConfigStorage.get("emojis_recent",function(e){var t,o;for(e=e||r||[],o=0;o<e.length;o++)t=e[o],n[t]&&i.push('<a href="javascript:void(0)" title="'+a.htmlEntities(t)+'">'+a.createIcon(n[t],!0)+'<span class="label">'+a.htmlEntities(t)+"</span></a>");s()})},a.prototype.hide=function(e){console.log("EmojiMenu.prototype.hide"),this.visible=!1,this.$menu.hide("fast")},a.prototype.show=function(e){if(console.log("EmojiMenu.prototype.show"),this.visible)return this.hide();d(this.$menu).css("z-index",++a.menuZIndex),this.$menu.show("fast"),this.currentCategory||this.load(0),this.visible=!0}}(jQuery,window,document);